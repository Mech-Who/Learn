# 反模式

## 关注点

- 反模式简介；
- 反模式示例；
- 开发过程中的常见陷阱；

## 简介

软件设计原则提供了一套规则或准则，能够帮助软件开发人员在设计层面进行决策。

不良设计主要表现在4个方面：

- 不动性：以这种方式开发的应用程序非常难以重用。
- 刚性:以这种方式开发的应用程序，任何小的修改都会导致软件的太多部分必须进行相应的改动，所谓“牵一发而动全身”
- 脆弱性:当前应用程序的任何更改都会导致现有系统变得非常容易崩溃
- 粘滞性:由于架构层面的修改非常困难，因此修改必须由开发人员在代码或环境本身中进行。

导致反模式的原因：

- 开发人员不了解软件开发实践。
- 开发人员没有将设计模式应用到正确的上下文中。

实际上，反模式也是有益的，毕竟通过它我们有机会实现以下目标：

- 识别软件行业中经常出现的问题，并为其中的大多数问题提供详细的补救措施。
- 开发相应的工具来识别这些问题，并确定其根本原因。
- 描述可用于应用程序和架构层次上的改进措施。

反模式可以分为两大类：

1. 软件开发反模式。
2. 软件架构反模式。

## 软件开发反模式

当应用程序或项目进入软件开发阶段时，就需要考虑代码结构了。这种结构需要与产品架构、设计、客户使用案例以及许多其他开发考虑因素保持一致。

通常情况下，在进行软件开发时，往往会偏离最初的代码结构，原因如下：

- 开发人员的想法会随着开发过程的推进而发生变化。
- 用例通常会随着客户的反馈而进行更改。
- 最初设计的数据结构可能会随功能或可伸缩性等方面的考虑而发生变化。

基于上述原因，软件通常需要进行重构。虽然重构带有许多负面含义，但实际上，重构是软件开发过程的关键部分之一，为开发人员提供了一个机会来重新评估数据结构，并重新审视可扩展性和不断变化的客户需求。

下面，我们将列举软件开发和架构中的几种反模式，并简要介绍其原因、症状和后果。

### 意大利面条式代码

意大利面条式代码的典型成因包括:

- 对面向对象编程和分析的无知;
- 没有考虑产品的架构或设计;
- 快餐式思维。

当你遭遇意大利面条式代码时，就会面临下列问题:

- 结构的重用性将会降到最低:
- 维护工作量过高
- 进行修改时，扩展性和灵活性会降低。

### 金锤

之所以出现金锤，典型的原因有如下几个:

- 来自不了解具体问题的高层(架构师或技术领袖)的建议；
- 虽然某解决方案在过去多次验证有效，但当前项目却具有不同的背景和要求；
- 公司已经被这种技术“绑架”了，因为他们已经在它上面投资了大量资金来培训员工，或员工们对这种技术情有独钟，因为已经用顺手了。

金锤的影响如下所示:

- 痴迷于一个解决方案，并把它应用于所有软件项目；
- 不是通过功能，而是通过开发中使用的技术来描述产品；
- 你会在公司走廊中听到开发人员说“怎么可能比这个解决方案更好呢”；
- 没有满足需求，造成与用户的预期不符。

### 熔岩流

熔岩流的成因包括以下几个:

- 在产品中有大量的试错代码；
- 由一个人单独编写的代码，未经审查，就在没有任何培训的情况下移交给了其他开发团队；
- 软件架构或设计的初始思想是通过代码库实现的，但没有人能理解它。

熔岩流的症状如下:

- 开发的测试工作(如果完成的话)具有很低的代码覆盖率；
- 代码中含有莫名奇妙的注释；
- 过时的接口，或开发人员需要围绕既有代码展开工作；

### 复制粘贴或剪切粘贴式编程

导致复制粘贴或剪切粘贴式编程的原因如下：

- 新手开发者不习惯编写代码或不知道如何开发代码；
- 快速修复bug或“急就章”式的开发；
- 代码重复，无法满足跨模块标准化以及代码结构化的要求；
- 缺乏长远打算或深谋远虑。

剪切粘贴或复制粘贴式编程的后果包括:

- 多个软件应用程序存在同种类型的问题；
- 维护成本会更高，同时bug的生命周期也会变得更长；
- 较少的模块化代码库，相同的代码会散落于多处；
- 继承问题。

## 软件架构反模式

软件架构是整个系统架构的重要组成部分。虽然系统架构需要侧重于诸如设计、工具和硬件等方面，但软件架构则侧重于软件建模，以便于开发和测试团队、产品经理和其他利益相关者充分理解系统。这个架构在软件的实现能否成功以及确定产品的工作方式方面发挥了关键作用。

我们将讨论在开发和实现软件架构过程中实际观察到的一些架构级反模式。

### 重新发明轮子

导致重新发明轮子的原因如下:

- 缺乏中央文档或存储库来讲解架构级问题和存放已实现的解决方案；
- 社区或公司内的技术领袖之间缺乏沟通；
- 组织中遵循的流程是从头开始构建的，通常情况下，这样的流程是不成熟的，并且流程的实现通常是不严谨的，并且很难坚持

这种反模式的后果如下所示:

- 解决一个标准问题的解决方案太多，其中许多解决方案考虑得并不周全；
- 会耗费工程团队更多的时间和资源，导致预算超标，上市时间延后；
- 封闭的系统架构(仅适用于一种产品的架构)、重复劳动和糟糕的风险管理

### 供应商套牢

以下是导致供应商锁定的原因：

- 熟悉供应商公司的权威人士以及技术采购的可能折扣；
- 基于营销和销售业务而不是技术评估选择的技术；
- 在当前项目中使用经过验证的技术(验证表明，使用此技术的投资回报率非常高)；
- 即使它不适合当前项目的需要或要求；
- 技术人员/开发人员已经接受过相关技术的培训。

供应商锁定的后果如下所示:

- 公司产品的发布周期和维护周期直接取决于供应商的发布时间；
- 该产品是围绕该技术而不是根据客户的要求开发的；
- 产品上市时间不可靠，不能满足客户的期望。

### 委员会设计

委员会设计的原因如下:

- 根据组织的流程，产品的架构或设计是由众多的利益相关者批准的；
- 没有指定单独的联系人或负责设计的架构师；
- 由营销或技术专家确定设计优先级，而不是由客户反馈来确定。

与该模式有关的症状如下所示:

- 开发人员和架构师之间的观点冲突，即使在设计完成后依旧如此；
- 过于复杂的设计，很难记录；
- 规格或设计的任何改动都需要经过多次审查，导致实现延迟。
